<?php
/* Copyright (C) 2011 by iRail vzw/asbl
 *
 * Author: Pieter Colpaert <pieter aÅ§ iRail.be>
 * License: AGPLv3
 *
 * This file prettyprints autogenerated API Documentation
 */
ini_set("include_path", "../");
include_once("error/Exceptions.class.php");

/**
 * Get all derived classes from another class
 */
function getAllDerivedClasses($classname){
     $result = array();
     foreach(get_declared_classes() as $class){
	  if(get_parent_class($class) == $classname){
	       $result[] = $class;
	  }
     }
     return $result;
}

//print page
include_once("templates/TheDataTank/header.php");

echo "<h1>Modules and methods</h1>";
if ($handle = opendir('../modules/')) {
     $done_methods = array();
     while (false !== ($modu = readdir($handle))) {
	  if ($modu != "." && $modu != ".." && is_dir("../modules/" . $modu)) {
	       echo "<h2>$modu</h2>\n";
	       if ($handle2 = opendir('../modules/' . $modu)) {
		    while (false !== ($metho = readdir($handle2))) {
			 //Check if it is a rightfull php class
			 $arr = explode(".class.", $metho);
			 if ($metho != "." && $metho != ".." && sizeof($arr) > 1) {
			      include_once("modules/" . $modu . "/" . $metho);
			 }
		    }
		    closedir($handle2);
	       }
	       foreach(getAllDerivedClasses("AMethod") as $class){
		    //BUG; functions with same name don't get shown!!!
		    if(!in_array($class,$done_methods)){
			 echo "<h3>$class</h3>";
			 //get a sequence of the parameters
			 $args = "";
			 if(sizeof($class::getRequiredParameters()) > 0){
			      $params = $class::getRequiredParameters();
			      $args="?" . $params[0] . "=...";
			      $i = 0;
			      foreach($params as $var){
				   if($i == 0) continue;
				   $args .= "&$var=...";
				   $i++;
			      }
			 }
			 echo "<strong>" . $class::getDoc() ."</strong>";
			 $url = "http://".$_SERVER["SERVER_NAME"] . "/$modu/$class/$args";
			 echo "<h4><a href=\"$url\">$url</a></h4>";
			 echo "<ul>\n";
			 echo "<h4>All possible parameters</h4>";
			 foreach($class::getParameters() as $var => $doc){
			      echo "<li><strong>$var:</strong> $doc\n";
			 }
			 echo "</ul>\n";
			 echo "<br/>";
			 $done_methods[] = $class;
		    }
	       }
	  }
     }
     closedir($handle);
     }

     echo "<h1>Errors</h1>";

foreach(getAllDerivedClasses("AbstractTDTException") as $class){
     echo "<h3>".$class::$error." - $class</h3>";
     echo $class::getDoc();
     echo "<br/>";
}

include_once("templates/TheDataTank/footer.php");
?>